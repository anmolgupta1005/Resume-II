sudo:
  true

language:
  generic

# We need Docker here
services:
  - Docker

# Prepare package manager apt
before_install:
  - sudo apt-get install apt-file
  - sudo apt-get -yq update
  - sudo chmod ugo+x scripts/latex_compiler.sh

# Get the latest version of Docker to run on Travis virtual core
install:
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce

# Build the latex embedded Docker image
before_script:
  - docker build -t latex_compiler .

# Run the Docker image in a container
jobs:
  include:
    script: scripts/./latex_compiler.sh

# If latex document successfully build, copy back to repo
after_success:
  - docker cp Resume_Builder:/data/out/* .

# Setup tag name
before_deploy:
  - git config --local user.name "anmolgupta1005"
  - git config --local user.email "anmol.gupta1005@gmail.com"
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')}
  - git tag $TRAVIS_TAG

deploy:
  - provider: releases
  - api_key: "$GITHUB_OAUTH_TOKEN"
  - file:
  - skip_cleanup: true
  on:
    tags: true